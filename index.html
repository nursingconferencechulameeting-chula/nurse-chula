<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>QR Scanner Pro 2026</title>

  <!-- CSS Libs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap">

  <style>
    :root {
      --primary-color: #004085;
      --secondary-color: #6610f2;
      --scan-color: #00ff00;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #1a1a1a; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏ô‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á */
      color: #fff;
      overflow-x: hidden;
    }

    /* Navbar ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ */
    .navbar {
      background: rgba(0, 0, 0, 0.8) !important;
      backdrop-filter: blur(10px);
    }
    .navbar-brand { font-weight: 800; color: #fff !important; }

    /* Container ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á */
    .scanner-wrapper {
      position: relative;
      width: 100%;
      height: 60vh; /* ‡∏™‡∏π‡∏á 60% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
      background: #000;
      overflow: hidden;
      border-radius: 0 0 30px 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Video ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
    #reader {
      width: 100% !important;
      height: 100% !important;
      border: none !important;
    }
    #reader video {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
    }

    /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏á (Overlay) */
    .scan-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
    }
    .viewfinder {
      width: 250px;
      height: 250px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      position: relative;
      box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.5); /* ‡∏ó‡∏≥‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î‡∏£‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å */
    }
    /* ‡∏°‡∏∏‡∏°‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏á */
    .viewfinder::before {
      content: "";
      position: absolute;
      top: -2px; left: -2px; width: 40px; height: 40px;
      border-top: 5px solid var(--scan-color);
      border-left: 5px solid var(--scan-color);
      border-radius: 15px 0 0 0;
    }
    .viewfinder::after {
      content: "";
      position: absolute;
      bottom: -2px; right: -2px; width: 40px; height: 40px;
      border-bottom: 5px solid var(--scan-color);
      border-right: 5px solid var(--scan-color);
      border-radius: 0 0 15px 0;
    }

    /* ‡πÄ‡∏™‡πâ‡∏ô‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏≠‡∏ô‡πÅ‡∏™‡∏Å‡∏ô */
    .scan-line {
      position: absolute;
      width: 100%;
      height: 3px;
      background: linear-gradient(to right, transparent, var(--scan-color), transparent);
      top: 0;
      animation: scanMove 2s infinite linear;
    }

    @keyframes scanMove {
      0% { top: 0; }
      100% { top: 100%; }
    }

    /* ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
    .control-panel {
      padding: 30px 20px;
      background: #1a1a1a;
    }

    .btn-day {
      border-radius: 15px;
      padding: 15px;
      font-weight: 800;
      font-size: 1.1rem;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    .btn-day.active {
      background: var(--secondary-color) !important;
      color: #fff !important;
      border-color: #fff;
      transform: scale(1.05);
    }

    .btn-action {
      border-radius: 50px;
      padding: 15px 30px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    [v-cloak] { display: none; }
  </style>
</head>
<body>

  <div id="app" v-cloak>
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top shadow">
      <div class="container justify-content-center">
        <a class="navbar-brand" href="#">
          <i class="fa-solid fa-qrcode text-info me-2"></i>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ 2569
        </a>
      </div>
    </nav>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
    <div class="scanner-wrapper">
      <div id="reader"></div>
      
      <!-- Overlay ‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏•‡πá‡∏á ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏Å‡∏ô -->
      <div v-show="isScanning" class="scan-overlay">
        <div class="viewfinder">
          <div class="scan-line"></div>
        </div>
      </div>

      <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏™‡∏Å‡∏ô -->
      <div v-if="!isScanning" class="h-100 d-flex align-items-center justify-content-center flex-column p-4 text-center">
        <i class="fa-solid fa-camera fa-4x mb-3 opacity-20"></i>
        <h4>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô</h4>
        <p class="text-muted">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô" ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
      </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
    <div class="control-panel">
      <div class="container">
        
        <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
        <div class="row g-3 mb-4">
          <div class="col-6">
            <button class="btn btn-dark btn-day w-100" :class="{active: scanDay === '1'}" @click="scanDay = '1'">
              <small class="d-block opacity-50 fw-normal">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1</small>
              25 ‡∏™.‡∏Ñ. 69
            </button>
          </div>
          <div class="col-6">
            <button class="btn btn-dark btn-day w-100" :class="{active: scanDay === '2'}" @click="scanDay = '2'">
              <small class="d-block opacity-50 fw-normal">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2</small>
              26 ‡∏™.‡∏Ñ. 69
            </button>
          </div>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å -->
        <div class="d-grid gap-3">
          <button v-if="!isScanning" class="btn btn-primary btn-action shadow-lg" @click="startScanner" :disabled="loading">
            <i class="fa-solid fa-play me-2"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô QR Code
          </button>
          <button v-else class="btn btn-danger btn-action" @click="stopScanner">
            <i class="fa-solid fa-stop me-2"></i> ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
          </button>
          
          <button class="btn btn-outline-light border-0 opacity-75" @click="$refs.qrFileInput.click()" :disabled="loading">
            <i class="fa-solid fa-image me-2"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
          </button>
          <input type="file" ref="qrFileInput" class="d-none" accept="image/*" @change="handleQrUpload">
        </div>

        <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
        <div v-if="scannedUser" class="mt-4 animate__animated animate__fadeInUp">
          <div class="alert alert-success border-0 shadow bg-success text-white rounded-4 p-3">
            <div class="d-flex align-items-center">
              <i class="fa-solid fa-circle-check fs-2 me-3"></i>
              <div>
                <div class="fw-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>
                <div class="small">{{ scannedUser.message }}</div>
              </div>
              <button class="btn-close btn-close-white ms-auto" @click="scannedUser = null"></button>
            </div>
          </div>
        </div>

        <!-- Loading -->
        <div v-if="loading" class="text-center mt-3">
          <div class="spinner-border text-info" role="status"></div>
          <p class="small mt-2 text-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

      </div>
    </div>

  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>

  <script>
    const { createApp, ref } = Vue;

    // üõë ‡∏£‡∏∞‡∏ö‡∏∏ URL Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzfOu3S0v5_u0XJi-IdwTIx6HecySKswYFt05wjfCBbu5pyEYy2LPsFSUkL7d4dmdVK/exec";

    createApp({
      setup() {
        const isScanning = ref(false);
        const scanDay = ref('1');
        const scannedUser = ref(null);
        const loading = ref(false);
        let html5QrScanner = null;

        const startScanner = () => {
          scannedUser.value = null;
          isScanning.value = true;
          
          html5QrScanner = new Html5Qrcode("reader");
          
          // ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Å‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
          const config = { 
            fps: 15, 
            qrbox: { width: 250, height: 250 },
            aspectRatio: 1.0 // ‡πÉ‡∏ä‡πâ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô 1:1 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏∞‡∏£‡∏∞‡∏¢‡∏∞
          };

          html5QrScanner.start(
            { facingMode: "environment" }, // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
            config,
            (decodedText) => {
              // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
              const audio = new Audio('https://www.soundjay.com/buttons/beep-07a.mp3');
              audio.play();
              processAttendance(decodedText);
              stopScanner();
            }
          ).catch(err => {
            console.error(err);
            isScanning.value = false;
            Swal.fire("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á", "error");
          });
        };

        const stopScanner = () => {
          if (html5QrScanner) {
            html5QrScanner.stop().then(() => {
              isScanning.value = false;
            }).catch(err => console.error(err));
          }
        };

        const handleQrUpload = (e) => {
          const file = e.target.files[0];
          if (!file) return;

          loading.value = true;
          const scanner = new Html5Qrcode("reader");
          scanner.scanFile(file, true)
            .then(decodedText => {
              processAttendance(decodedText);
              loading.value = false;
            })
            .catch(err => {
              Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏û‡∏ö QR Code ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û", "warning");
              loading.value = false;
            });
        };

        const processAttendance = async (qrText) => {
          loading.value = true;
          try {
            const response = await fetch(GAS_WEB_APP_URL, {
              method: "POST",
              body: JSON.stringify({
                action: 'recordAttendance',
                data: { text: qrText, day: scanDay.value }
              }),
              headers: { "Content-Type": "text/plain;charset=utf-8" }
            });

            const result = await response.json();
            loading.value = false;

            if (result.success) {
              scannedUser.value = { message: result.message };
            } else {
              Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", result.message, "warning");
            }
          } catch (error) {
            loading.value = false;
            Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", "error");
          }
        };

        return {
          isScanning, scanDay, scannedUser, loading,
          startScanner, stopScanner, handleQrUpload
        };
      }
    }).mount('#app');
  </script>

</body>
</html>
