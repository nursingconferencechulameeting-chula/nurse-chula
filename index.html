  <script>
    // ðŸ›‘ 1. à¸£à¸°à¸šà¸¸ URL à¸‚à¸­à¸‡ Web App (GAS) à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzfOu3S0v5_u0XJi-IdwTIx6HecySKswYFt05wjfCBbu5pyEYy2LPsFSUkL7d4dmdVK/exec"; 

    const { createApp, ref, onMounted, computed, watch, nextTick } = Vue;

    createApp({
      setup() {
        // --- ðŸŸ¢ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: à¸›à¸£à¸°à¸à¸²à¸¨à¸•à¸±à¸§à¹à¸›à¸£ (Refs) ---
        const isReady = ref(false);
        const loading = ref(false);
        const loadingScanner = ref(false);
        const loadingUpload = ref(false);
        const loadingEval = ref(false);
        const loadingSchedule = ref(false);
        const currentView = ref('form');
        const step = ref(1);
        const isEditMode = ref(false);
        const isAdminLoggedIn = ref(false);
        const userRole = ref('');
        const showPassword = ref(false);
        
        // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ (à¹‚à¸«à¸¥à¸”à¸ˆà¸²à¸ API)
        const COL = ref({ ID: 'ID', FNAME: 'à¸Šà¸·à¹ˆà¸­', LNAME: 'à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥', IMAGE: 'à¸£à¸¹à¸›à¸ à¸²à¸ž', EMAIL: 'Email', PHONE: 'à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ', LICENSE: 'à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¹ƒà¸šà¸›à¸£à¸°à¸à¸­à¸šà¸§à¸´à¸Šà¸²à¸Šà¸µà¸ž', REG_TYPE: 'à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™', POSITION: 'à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™', FOOD: 'à¸›à¸£à¸°à¹€à¸ à¸—à¸­à¸²à¸«à¸²à¸£', WORK_GROUP: 'à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™', DEPARTMENT: 'à¸«à¸™à¹ˆà¸§à¸¢à¸‡à¸²à¸™', WORKPLACE: 'à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆà¸—à¸³à¸‡à¸²à¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™', RECEIPT_NAME: 'à¸Šà¸·à¹ˆà¸­à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸à¹ƒà¸™à¹ƒà¸šà¹€à¸ªà¸£à¹‡à¸ˆà¸£à¸±à¸šà¹€à¸‡à¸´à¸™', ADDRESS: 'à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆ', TAX_ID: 'à¹€à¸¥à¸‚à¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§à¸œà¸¹à¹‰à¹€à¸ªà¸µà¸¢à¸ à¸²à¸©à¸µ', PAYIN_STATUS: 'à¸ªà¸–à¸²à¸™à¸° Pay-in', PAYMENT_STATUS: 'à¸ªà¸–à¸²à¸™à¸°à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™', SLIP: 'slip', ATTEND_1: 'à¸§à¸±à¸™à¸—à¸µà¹ˆ 1', ATTEND_2: 'à¸§à¸±à¸™à¸—à¸µà¹ˆ 2', CERT_URL: 'URL à¸›à¸£à¸°à¸à¸²à¸¨à¸™à¸µà¸¢à¸šà¸±à¸•à¸£', DOWNLOAD: 'à¸ˆà¸³à¸™à¸§à¸™à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”' });
        const REG_STATUS = ref({ INTERNAL: 'à¸žà¸¢à¸²à¸šà¸²à¸¥à¹ƒà¸™à¸à¹ˆà¸²à¸¢à¸à¸²à¸£à¸žà¸¢à¸²à¸šà¸²à¸¥ à¸£à¸ž.à¸ˆà¸¸à¸¬à¸²à¸¥à¸‡à¸à¸£à¸“à¹Œ', QUOTA: 'à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¹‚à¸„à¸§à¸•à¹‰à¸²à¸•à¸²à¸¡à¸ˆà¸”à¸«à¸¡à¸²à¸¢à¹€à¸Šà¸´à¸', EXTERNAL: 'à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ à¸²à¸¢à¸™à¸­à¸' });
        
        // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸
        const prefixOptions = ref([]);
        const workGroupData = ref({});
        const currentDepts = ref([]);
        const affiliationOptions = ref([]);
        const professionOptions = ref([]);
        const OPTIONAL_POSITIONS = ['à¸§à¸´à¸—à¸¢à¸²à¸à¸£', 'à¸„à¸“à¸°à¸à¸£à¸£à¸¡à¸à¸²à¸£à¸¯', 'à¸žà¸´à¸˜à¸µà¸à¸£', 'à¸­à¸·à¹ˆà¸™à¹†'];

        // à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸²à¸£à¸²à¸‡ Admin
        const adminData = ref([]);
        const originalAdminData = ref([]);
        const searchAdminQuery = ref('');
        const filterRegType = ref('');
        const currentPage = ref(1);
        const itemsPerPage = 15;
        const savingRows = ref({});

        // à¸Ÿà¸­à¸£à¹Œà¸¡à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™
        const form = ref({
          rowNumber: null, id: '', timestamp: '', email: '', title_Name: 'à¸™à¸²à¸‡à¸ªà¸²à¸§',
          firstName: '', lastName: '', phoneNumber: '', proLicense: '',
          foodType: 'à¸­à¸²à¸«à¸²à¸£à¸—à¸±à¹ˆà¸§à¹„à¸›', status_Register: '', internalPosition: 'à¸žà¸¢à¸²à¸šà¸²à¸¥',
          workGroup: '', department: '', affiliation: '', workPlace: '',
          name_Receipt: '', taxpayer_ID: '', address: ''
        });

        // ðŸš© à¹à¸à¹‰à¹„à¸‚ Error 'id': à¸à¸³à¸«à¸™à¸”à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ editForm à¹ƒà¸«à¹‰à¸Šà¸±à¸”à¹€à¸ˆà¸™à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¸•à¹‰à¸™
        const editForm = ref({ 
          id: '', rowNumber: null, timestamp: '', email: '', title_Name: '', firstName: '', lastName: '', 
          phoneNumber: '', proLicense: '', status_Register: '', foodType: '', internalPosition: '', 
          workGroup: '', department: '', name_Receipt: '', taxpayer_ID: '', workplace: '', address_main: ''
        });
        const originalForm = ref(null);

        // à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¹€à¸§à¸¥à¸²
        const deadlineTimestamp = ref(null);
        const externalDeadline = ref(null);
        const assessmentTimer = ref(null);
        const certDeadline = ref(null);

        // à¹à¸šà¸šà¸›à¸£à¸°à¹€à¸¡à¸´à¸™
        const evalDay = ref(1);
        const evalForm = ref({ origin: '', gift: '', overallRating: '', nextTopic: '', feedback: '' });
        const day1Questions = ref([]);
        const day2Questions = ref([]);
        const subItems = [
          { id: 1, text: 'à¸«à¸±à¸§à¸‚à¹‰à¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆ' }, { id: 2, text: 'à¸„à¸§à¸²à¸¡à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸‚à¸­à¸‡à¹€à¸™à¸·à¹‰à¸­à¸«à¸²' },
          { id: 3, text: 'à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸›à¹‡à¸™à¸›à¸£à¸°à¹‚à¸¢à¸Šà¸™à¹Œ' }, { id: 4, text: 'à¸„à¸§à¸²à¸¡à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸‚à¸­à¸‡à¸ªà¸·à¹ˆà¸­à¸à¸²à¸£à¸šà¸£à¸£à¸¢à¸²à¸¢' },
          { id: 5, text: 'à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡' }
        ];

        // à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£à¹à¸¥à¸°à¸ªà¹à¸à¸™
        const scheduleData = ref({ day1: [], day2: [] });
        const downloadCount = ref(0);
        const scanDay = ref('1');
        const isScanning = ref(false);
        const scannedUser = ref(null);
        let html5QrCode = null;

        // à¸à¸¥à¹‰à¸­à¸‡
        const isCameraActive = ref(false);
        const profilePreview = ref(null);
        const cameraZoom = ref(1.0);
        let webcam = null;
        let cropper = null;
        const cropModal = ref(null);

        // --- ðŸŸ¢ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: API Bridge (fetch) ---
        const api = async (action, data = {}) => {
          try {
            const response = await fetch(GAS_WEB_APP_URL, {
              method: 'POST',
              body: JSON.stringify({ action, data }),
              headers: { 'Content-Type': 'text/plain;charset=utf-8' }
            });
            return await response.json();
          } catch (error) {
            console.error("API Error:", error);
            return { success: false, message: "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¹„à¸”à¹‰" };
          }
        };

        // --- ðŸŸ¢ à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 3: Logic à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ---

        onMounted(async () => {
          const res = await api('loadInitialData');
          if (res) {
            COL.value = res.COL || COL.value;
            REG_STATUS.value = res.REG_STATUS || REG_STATUS.value;
            workGroupData.value = res.workGroups || {};
            prefixOptions.value = res.prefixes || [];
            affiliationOptions.value = res.affiliations || [];
            professionOptions.value = res.professions || [];
            deadlineTimestamp.value = res.deadlines.reg;
            externalDeadline.value = res.deadlines.external;
            assessmentTimer.value = res.deadlines.assessment;
            certDeadline.value = res.deadlines.cert;
            isReady.value = true;
          }
          const modalEl = document.getElementById('cropModal');
          if (modalEl) cropModal.value = new bootstrap.Modal(modalEl);
          initThailandJS();
          checkLocalSession();
        });

        const checkLocalSession = () => {
          const s = localStorage.getItem('nursing_admin_session');
          if (s) {
            const d = JSON.parse(s);
            isAdminLoggedIn.value = true;
            login.value.user = d.user;
            userRole.value = d.role;
          }
        };

        // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Logout (ðŸš© à¹à¸à¹‰à¹„à¸‚ Error logoutAdmin)
        const logoutAdmin = () => {
          localStorage.removeItem('nursing_admin_session');
          isAdminLoggedIn.value = false;
          login.value = { user: '', pass: '' };
          userRole.value = '';
          currentView.value = 'form';
          Swal.fire({ icon: 'success', title: 'à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§', timer: 1000, showConfirmButton: false });
        };

        const handleSearch = async () => {
          if (!searchQuery.value) return;
          loading.value = true;
          const res = await api('searchUser', { query: searchQuery.value });
          loading.value = false;
          if (res.success) {
            searchResult.value = res.data;
            setTimeout(() => document.getElementById('search-result-section')?.scrollIntoView({ behavior: 'smooth' }), 100);
          } else Swal.fire("à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥", res.message, "info");
        };

        const submitForm = async () => {
          loading.value = true;
          Swal.fire({ title: 'à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
          const action = isEditMode.value ? 'updateForm' : 'processForm';
          const res = await api(action, { ...form.value, profilePreview: profilePreview.value });
          if (res.success) {
            Swal.fire("à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", res.message, "success").then(() => { resetForm(); currentView.value = 'form'; });
          } else Swal.fire("à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§", res.message, "error");
          loading.value = false;
        };

        const handleAdminLogin = async () => {
          if (!login.value.pass) return;
          loading.value = true;
          const res = await api('checkAdminLogin', { password: login.value.pass });
          loading.value = false;
          if (res.success) {
            isAdminLoggedIn.value = true;
            login.value.user = res.username;
            userRole.value = res.role;
            localStorage.setItem('nursing_admin_session', JSON.stringify({ user: res.username, role: res.role }));
            loadAdminTable();
          } else Swal.fire("à¸œà¸´à¸”à¸žà¸¥à¸²à¸”", "à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡", "error");
        };

        const loadAdminTable = async () => {
          loading.value = true;
          const res = await api('getAdminAllData');
          adminData.value = res;
          originalAdminData.value = JSON.parse(JSON.stringify(res));
          loading.value = false;
        };

        const saveAdminUpdate = async (item) => {
          savingRows.value[item.rowNumber] = true;
          const res = await api('updateAdminStatus', { rowNumber: item.rowNumber, item: item });
          if (res.success) {
            Swal.fire({ icon: 'success', title: 'à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', timer: 800, showConfirmButton: false });
            loadAdminTable();
          }
          savingRows.value[item.rowNumber] = false;
        };

        const openAdminEditModal = (item) => {
          editForm.value = JSON.parse(JSON.stringify(item));
          editForm.value.id = item[COL.value.ID] || ''; 
          new bootstrap.Modal('#adminEditModal').show();
        };

        const submitAdminEdit = async () => {
          loading.value = true;
          const res = await api('updateForm', editForm.value);
          if (res.success) {
            Swal.fire("à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", "à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¹‰à¸§", "success");
            bootstrap.Modal.getInstance('#adminEditModal').hide();
            loadAdminTable();
          }
          loading.value = false;
        };

        const confirmDelete = (rowNum) => {
          Swal.fire({ title: 'à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥?', text: "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸šà¹„à¸”à¹‰", icon: 'warning', showCancelButton: true }).then(async (r) => {
            if (r.isConfirmed) {
              const res = await api('deleteRegistration', { rowNumber: rowNum });
              if (res.success) loadAdminTable();
            }
          });
        };

        const fetchAssessmentConfig = async () => {
          loadingEval.value = true;
          const res = await api('getAssessmentConfig');
          if (res.success) { day1Questions.value = res.day1; day2Questions.value = res.day2; }
          loadingEval.value = false;
        };

        const submitEvaluation = async (e) => {
          e.preventDefault();
          loading.value = true;
          const res = await api('saveAssessment', { ...evalForm.value, evalDay: evalDay.value });
          if (res.success) {
            Swal.fire("à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", "à¸‚à¸­à¸šà¸„à¸¸à¸“à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸›à¸£à¸°à¹€à¸¡à¸´à¸™", "success");
            currentView.value = 'form';
          }
          loading.value = false;
        };

        const navToSchedule = async () => {
          currentView.value = 'schedule';
          loadingSchedule.value = true;
          const res = await api('getSchedule');
          if (res.success) scheduleData.value = res.data;
          loadingSchedule.value = false;
        };

        const startScanner = () => {
          isScanning.value = true;
          setTimeout(() => {
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, 
            (txt) => { processAttendance(txt); stopScanner(); });
          }, 500);
        };

        const stopScanner = () => { if (html5QrCode) { html5QrCode.stop(); html5QrCode = null; } isScanning.value = false; };

        const processAttendance = async (txt) => {
          loadingScanner.value = true;
          const res = await api('recordAttendance', { text: txt, day: scanDay.value });
          if (res.success) {
            Swal.fire("à¸ªà¸³à¹€à¸£à¹‡à¸ˆ", res.message, "success");
            loadAdminTable();
          } else Swal.fire("à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§", res.message, "error");
          loadingScanner.value = false;
        };

        const startWebcam = async () => {
          isCameraActive.value = true;
          await nextTick();
          webcam = new Webcam(document.getElementById('webcam'), 'user', document.getElementById('canvas'));
          await webcam.start();
        };

        const stopWebcam = () => { if(webcam) webcam.stop(); isCameraActive.value = false; };

        const capturePhoto = () => {
          const canvas = document.getElementById('canvas');
          const video = document.getElementById('webcam');
          canvas.width = video.videoWidth; canvas.height = video.videoHeight;
          canvas.getContext('2d').drawImage(video, 0, 0);
          openCropModal(canvas.toDataURL('image/jpeg'));
          stopWebcam();
        };

        const openCropModal = (src) => {
          document.getElementById('imageToCrop').src = src;
          cropModal.value.show();
          setTimeout(() => {
            cropper = new Cropper(document.getElementById('imageToCrop'), { aspectRatio: 1, viewMode: 1 });
          }, 300);
        };

        const applyCrop = () => {
          profilePreview.value = cropper.getCroppedCanvas({ width: 400, height: 400 }).toDataURL('image/jpeg');
          cropModal.value.hide();
        };

        const selectMenu = (v) => { 
          currentView.value = v; 
          if(v === 'AssessmentForm') fetchAssessmentConfig();
          if(v === 'dashboard' && isAdminLoggedIn.value) loadAdminTable();
        };

        const resetForm = () => { 
          isEditMode.value = false; step.value = 1; profilePreview.value = null;
          form.value = { title_Name: 'à¸™à¸²à¸‡à¸ªà¸²à¸§', foodType: 'à¸­à¸²à¸«à¸²à¸£à¸—à¸±à¹ˆà¸§à¹„à¸›', internalPosition: 'à¸žà¸¢à¸²à¸šà¸²à¸¥' };
        };

        const formatPhone = (e) => { let v = e.target.value.replace(/\D/g,''); form.value.phoneNumber = v.length > 6 ? v.slice(0,3)+'-'+v.slice(3,6)+'-'+v.slice(6) : v; };

        // Computed
        const filteredAdminData = computed(() => {
          return adminData.value.filter(i => {
            const mType = !filterRegType.value || i[COL.value.REG_TYPE] === filterRegType.value;
            const mQuery = !searchAdminQuery.value || JSON.stringify(i).toLowerCase().includes(searchAdminQuery.value.toLowerCase());
            return mType && mQuery;
          });
        });
        const paginatedAdminData = computed(() => filteredAdminData.value.slice((currentPage.value-1)*itemsPerPage, currentPage.value*itemsPerPage));
        const totalPages = computed(() => Math.ceil(filteredAdminData.value.length / itemsPerPage));
        const canUserEdit = computed(() => isAdminLoggedIn.value || (deadlineTimestamp.value && Date.now() < deadlineTimestamp.value));
        const isCertTimeOpen = computed(() => isAdminLoggedIn.value || (certDeadline.value && Date.now() >= certDeadline.value));

        return {
          isReady, loading, currentView, step, isEditMode, form, editForm, isAdminLoggedIn, userRole, login,
          COL, REG_STATUS, prefixOptions, workGroupData, currentDepts, affiliationOptions, professionOptions,
          searchQuery, searchResult, searchAdminQuery, filterRegType, paginatedAdminData, currentPage, totalPages,
          day1Questions, day2Questions, evalDay, evalForm, subItems, loadingEval,
          scheduleData, loadingSchedule, downloadCount, isScanning, scanDay, scannedUser,
          isCameraActive, profilePreview, cameraZoom, deadlineTimestamp, externalDeadline, assessmentTimer, certDeadline,
          api, handleSearch, submitForm, handleAdminLogin, logoutAdmin, selectMenu, resetForm,
          onWorkGroupChange: () => currentDepts.value = workGroupData.value[form.value.workGroup] || [],
          prepareEdit: (i) => { isEditMode.value = true; form.value = {...i}; profilePreview.value = i[COL.value.IMAGE]; step.value = 1; },
          formatThaiDate: (v, thai) => { if(!v) return '-'; const d = new Date(v); return d.toLocaleDateString('th-TH', { day:'numeric', month:'short', year: thai ? 'numeric' : '2-digit' }); },
          canUserEdit, isCertTimeOpen,
          canDownload: (i) => i[COL.value.CERT_URL] && i[COL.value.CERT_URL] !== '-',
          isRowChanged: (i) => JSON.stringify(i) !== JSON.stringify(originalAdminData.value.find(o => o.rowNumber === i.rowNumber)),
          saveAdminUpdate, confirmDelete, openAdminEditModal, submitAdminEdit,
          runBatchCert: async () => { loading.value = true; await api('batchGenerateCertificates'); loadAdminTable(); },
          changePage: (p) => currentPage.value = p,
          startWebcam, stopWebcam, capturePhoto, applyCrop, retakePhoto: () => { profilePreview.value = null; startWebcam(); },
          handleFileUpload: (e) => { const reader = new FileReader(); reader.onload = (ev) => openCropModal(ev.target.result); reader.readAsDataURL(e.target.files[0]); },
          handleSlipUpload: (e) => { const reader = new FileReader(); reader.onload = (ev) => form.value.slipImage = ev.target.result; reader.readAsDataURL(e.target.files[0]); },
          startScanner, stopScanner, changeDay: (d) => evalDay.value = d, submitEvaluation,
          navToSchedule, handleDownload: () => window.open('https://drive.google.com/file/d/1I3d1gsZPbyteUlV0D_yPfWwUNyn6JJrU/view'),
          openSpeakerModal: (s) => { if(!s.img) return; document.getElementById('modalImageExpanded').src = s.img; document.getElementById('speakerDetailModal').style.display='flex'; },
          closeSpeakerModal: () => document.getElementById('speakerDetailModal').style.display='none',
          formatPhone,
          scrollToTop: () => window.scrollTo({top:0, behavior:'smooth'}),
          scrollToBottom: () => window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'}),
          hasImage: (img) => img && img !== '-',
          onScheduleDownload: async (item) => { await api('trackDownload', { rowNum: item.rowNumber }); item.file.count++; },
          OPTIONAL_POSITIONS, navToAdmin: () => { currentView.value = 'dashboard'; },
          formatPassword: () => { login.value.pass = login.value.pass.replace(/[à¸-à¹™]/g, ""); },
          formatName: (f) => { form.value[f] = form.value[f].replace(/[^A-Za-zà¸-à¹™]/g, ""); },
          formatEmail: () => { form.value.email = form.value.email.replace(/[^a-zA-Z0-9@._\-\+]/g, ""); },
          copyName: () => { form.value.name_Receipt = `${form.value.title_Name}${form.value.firstName} ${form.value.lastName}`; },
          onDownloadClick: (row) => api('trackDownload', { rowNum: row }),
          goToSummary: () => { step.value = 2; }, confirmCancelEdit: () => resetForm(),
          summaryFilter: ref({ date: '', origin: '' }), summaryData: ref(null), loadSummary: () => {}, 
          filteredQuestionsForSummary: computed(() => []), navToSummary: () => { currentView.value = 'summary'; }, getPercent: () => '0%'
        }
      }
    }).mount('#app');

    function initThailandJS() {
        if (typeof $.Thailand !== 'undefined') {
            $.Thailand({
                $district: $("#sub_district"), $amphoe: $("#district"), $province: $("#province"), $zipcode: $("#postcode"),
                onDataFill: (data) => {
                    const app = document.getElementById('app').__vue_app__._instance.proxy;
                    app.form.address_subdistrict = data.district;
                    app.form.address_district = data.amphoe;
                    app.form.address_province = data.province;
                    app.form.address_postcode = data.zipcode;
                }
            });
        }
    }
  </script>
