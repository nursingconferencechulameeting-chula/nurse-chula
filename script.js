// /** üü¢ ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
// const COL = {
//   ID: "ID",
//   TIMESTAMP: "tiemstarmp",
//   EMAIL: "Email",
//   TITLE: "‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤",
//   FNAME: "‡∏ä‡∏∑‡πà‡∏≠",
//   LNAME: "‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•",
//   PHONE: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
//   LICENSE: "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û",
//   REG_TYPE: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",
//   POSITION: "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
//   FOOD: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
//   WORK_GROUP: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô",
//   DEPARTMENT: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô",
//   WORKPLACE: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
//   RECEIPT_NAME: "‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô",
//   ADDRESS: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà",
//   TAX_ID: "‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ",
//   IMAGE: "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û", // ‡πÄ‡∏Å‡πá‡∏ö URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß
//   PAYIN_STATUS: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Pay-in",
//   PAYMENT_STATUS: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
//   SLIP: "slip", // ‡πÄ‡∏Å‡πá‡∏ö URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
//   ATTEND_1: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1",
//   ATTEND_2: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2",
//   ATTEND_1_TIME: "Timestamp Day1",
//   ATTEND_2_TIME: "Timestamp Day2",
//   CERT_URL: "URL ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£",
//   DOWNLOAD: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î"
// };
// /** üü¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° */
// const REG_STATUS = {
//   INTERNAL: '‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÉ‡∏ô‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡∏£‡∏û.‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏á‡∏Å‡∏£‡∏ì‡πå',
//   QUOTA: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏ä‡∏¥‡∏ç',
//   EXTERNAL: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å'
// };

// const SHEET_DATA = "Responses"; // sheet ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
// const SHEET_CONFIG = "Config";  // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ

// /** * Displays the HTML form when the web app is accessed. */
// function doGet() {
//   let tmp = HtmlService.createTemplateFromFile('index');
  
//   // üü¢ ‡∏™‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
//   tmp.COL = COL;
//   tmp.REG_STATUS = REG_STATUS; 
  
//   return tmp.evaluate()
//     .setTitle("‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• 2569")
//     .addMetaTag('viewport', 'width=device-width, initial-scale=1')
//     .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
// }

// /** ‡∏î‡∏∂‡∏á‡πÑ‡∏ü‡∏•‡πå include */
// function include(filename) {
//   return HtmlService.createHtmlOutputFromFile(filename).getContent();
// }

// /**
//  * Processes the form submission.
//  * @param {Object} formData - An object containing the form data.
//  * The keys of the object correspond to the 'name' attributes in the HTML form.
//  *   // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏°‡∏ò‡∏≠‡∏î POST
//   // ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á POST ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏° HTML
//   // ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ google.script.run ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
//   // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô doPost ‡∏°‡∏µ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP POST ‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
//   // ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏° ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ doPost ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
//   // ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥ doPost ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏Ñ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏¢‡∏±‡∏á processForm
//  */
// function doPost(e) {
//   let lock = LockService.getScriptLock();
//   let result = {};

//   try {
//     // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
//     if (!lock.tryLock(10000)) {
//       throw new Error('Could not obtain lock');
//     }

//     if (!e.postData || !e.postData.contents) {
//       throw new Error('No POST data received');
//     }

//     let formObject = JSON.parse(e.postData.contents);
//     result = processForm(formObject);// ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á
//   } catch (error) {
//     result = { success: false, message: 'Error: ' + error.message };
//   } finally {
//     // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
//     lock.releaseLock();
//   }

//   // Return JSON response
//   return ContentService.createTextOutput(JSON.stringify(result))
//     .setMimeType(ContentService.MimeType.JSON);
// }

// /** ############################################################################################ */
// /**
//  * Retrieves the Google Chat Webhook URL from script properties.
//  * @returns {string} The Google Chat Webhook URL.
//  * @throws {Error} If the CHAT_WEBHOOK_URL property is not set.
//  */
// function getChatWebhookUrl() {
//   const url = PropertiesService.getScriptProperties().getProperty('CHAT_WEBHOOK_URL');
//   if (!url) {
//     throw new Error('Google Chat Webhook URL is not set in Script Properties. Please go to File > Project properties > Script properties and add a property named "CHAT_WEBHOOK_URL" with your webhook URL as the value.');
//   }
//   return url;
// }
// // URL ‡∏Ç‡∏≠‡∏á Google Chat Webhook ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
// // *** ‡∏£‡∏∞‡∏ß‡∏±‡∏á: URL ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞ ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Script Properties ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ***
// // const CHAT_WEBHOOK_URL = 'https://chat.googleapis.com/v1/spaces/AAQAB2IPCew/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=Skm9In97QpJDGDE2psLtXp4EcrjcjIeeWGV6Ww5qg8U';

// /** ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà */
// function processForm(formData) {
//   const lock = LockService.getScriptLock();
//   try {
//     if (!lock.tryLock(15000)) return { success: false, message: "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á" };
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName(SHEET_DATA);
//     const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
//     const autoId = getNextId(); 

//     // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (ID_Profile)
//     let profileUrl = "-";
//     if (formData.profilePreview && formData.profilePreview.startsWith("data:image")) {
//       profileUrl = uploadProfileImage(formData.profilePreview, autoId + "_Profile", '1GC9_VU8DwkjkwYKdd8LY4daVtUBMJ0rs');
//     }

//     // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ (ID_Slip)
//     let slipUrl = "-";
//     if (formData.slipImage && formData.slipImage.startsWith("data:image")) {
//       slipUrl = uploadProfileImage(formData.slipImage, autoId + "_Slip", '1X_Bv5X7VNRik2DSDCtpsdtzoL1DGuWV0');
//     }

//     let rowData = new Array(headers.length).fill("");
//     const set = (colName, val) => { const idx = getIdx(headers, colName); if (idx > -1) rowData[idx] = val; };

//     set(COL.ID, autoId);
//     set(COL.TIMESTAMP, Utilities.formatDate(new Date(), Session.getScriptTimeZone(), "dd/MM/yyyy, HH:mm:ss"));
//     set(COL.EMAIL, formData.email || "-");
//     set(COL.TITLE, formData.title_Name);
//     set(COL.FNAME, formData.firstName);
//     set(COL.LNAME, formData.lastName);
//     set(COL.PHONE, formData.phoneNumber || "-");
//     set(COL.LICENSE, formData.proLicense || "-");
//     set(COL.REG_TYPE, formData.status_Register);
//     set(COL.FOOD, formData.foodType);
//     set(COL.IMAGE, profileUrl);
//     set(COL.SLIP, slipUrl); // üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏•‡∏¥‡∏õ

//     // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡πÄ‡∏î‡∏¥‡∏°)
//     let pos = "-"; let work = "-";
//     if (formData.status_Register === REG_STATUS.INTERNAL) {
//       pos = formData.internalPosition === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" ? formData.internalPosition_OtherText : formData.internalPosition;
//       work = "‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏á‡∏Å‡∏£‡∏ì‡πå";
//     } else if (formData.status_Register === REG_STATUS.QUOTA) {
//       pos = "‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤";
//       work = formData.affiliation === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" ? formData.affiliation_otherText : formData.affiliation;
//     } else {
//       work = formData.workPlace;
//       pos = formData.externalPosition === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" ? formData.externalPosition_OtherText : formData.externalPosition;
//     }
//     set(COL.POSITION, pos);
//     set(COL.WORKPLACE, work);
//     set(COL.WORK_GROUP, formData.workGroup || "-");
//     set(COL.DEPARTMENT, formData.department || "-");
//     set(COL.ADDRESS, formData.address || "-");
//     set(COL.RECEIPT_NAME, formData.name_Receipt || "-");
//     set(COL.TAX_ID, formData.taxpayer_ID || "-");

//     sheet.appendRow(rowData);
//     return { success: true, message: `‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ID: ${autoId}` };
//   } catch (error) { return { success: false, message: error.message }; } finally { lock.releaseLock(); }
// }

// /** ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
// function updateForm(formData) {
//   const lock = LockService.getScriptLock();
//   try {
//     if (!lock.tryLock(15000)) return { success: false, message: "‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á..." };
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName(SHEET_DATA);
//     const rowIndex = formData.rowNumber;
//     const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
//     let rowData = sheet.getRange(rowIndex, 1, 1, headers.length).getValues()[0];
//     const existingId = rowData[getIdx(headers, COL.ID)];

//     // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (ID_Profile)
//     if (formData.profilePreview && formData.profilePreview.startsWith("data:image")) {
//       deleteFileByUrl(rowData[getIdx(headers, COL.IMAGE)]);
//       rowData[getIdx(headers, COL.IMAGE)] = uploadProfileImage(formData.profilePreview, existingId + "_Profile", '1GC9_VU8DwkjkwYKdd8LY4daVtUBMJ0rs');
//     }

//     // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ (ID_Slip)
//     if (formData.slipImage && formData.slipImage.startsWith("data:image")) {
//       deleteFileByUrl(rowData[getIdx(headers, COL.SLIP)]);
//       rowData[getIdx(headers, COL.SLIP)] = uploadProfileImage(formData.slipImage, existingId + "_Slip", '1X_Bv5X7VNRik2DSDCtpsdtzoL1DGuWV0');
//     }

//     const update = (colName, val) => { const idx = getIdx(headers, colName); if (idx > -1) rowData[idx] = val; };
//     update(COL.EMAIL, formData.email);
//     update(COL.TITLE, formData.title_Name);
//     update(COL.FNAME, formData.firstName);
//     update(COL.LNAME, formData.lastName);
//     update(COL.PHONE, formData.phoneNumber);
//     update(COL.LICENSE, formData.proLicense);
//     update(COL.FOOD, formData.foodType);
//     update(COL.ADDRESS, formData.address || "-");
//     update(COL.RECEIPT_NAME, formData.name_Receipt || "-");
//     update(COL.TAX_ID, formData.taxpayer_ID || "-");

//     clearTimerCache();
//     sheet.getRange(rowIndex, 1, 1, headers.length).setValues([rowData]);
//     return { success: true, message: "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" };
//   } catch (e) { return { success: false, message: e.toString() }; } finally { lock.releaseLock(); }
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û Base64 ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Drive
//  */
// function uploadProfileImage(base64Data, filename, folderId) {
//   try {
//     // ‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Data URL
//     const splitData = base64Data.split(',');
//     const contentType = splitData[0].match(/:(.*?);/)[1]; // ‡∏î‡∏∂‡∏á mime type (‡πÄ‡∏ä‡πà‡∏ô image/jpeg)
//     const rawData = Utilities.base64Decode(splitData[1]);
//     const blob = Utilities.newBlob(rawData, contentType, filename);
    
//     // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå
//     const folder = DriveApp.getFolderById(folderId);
//     const file = folder.createFile(blob);
    
//     // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ)
//     file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
    
//     // ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô URL ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
//     return "https://lh5.googleusercontent.com/d/" + file.getId();
//   } catch (e) {
//     Logger.log("Error uploading image: " + e.message);
//     return "-";
//   }
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏≤ ID ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö NS-000
//  */
// function getNextId() {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName(SHEET_DATA);
//   const prefix = "NS-"; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏±‡∏ß‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
  
//   const lastRow = sheet.getLastRow();
//   if (lastRow < 2) return prefix + "001"; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà NS-001

//   // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
//   const idValues = sheet.getRange(2, 1, lastRow - 1, 1).getValues();
//   let maxNumber = 0;

//   for (let i = 0; i < idValues.length; i++) {
//     let idString = String(idValues[i][0]); // ‡πÄ‡∏ä‡πà‡∏ô "NS-005"
//     if (idString.indexOf(prefix) !== -1) {
//       // ‡∏ï‡∏±‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ prefix ‡∏≠‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
//       let currentNumber = parseInt(idString.replace(prefix, ""));
//       if (!isNaN(currentNumber) && currentNumber > maxNumber) {
//         maxNumber = currentNumber;
//       }
//     }
//   }

//   // ‡∏£‡∏±‡∏ô‡πÄ‡∏•‡∏Ç‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
//   let nextNumber = maxNumber + 1;
  
//   // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏´‡∏•‡∏±‡∏Å (001, 002, 010, 100)
//   let formattedNumber = ("000" + nextNumber).slice(-3);
  
//   return prefix + formattedNumber;
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô Drive ‡∏à‡∏≤‡∏Å URL ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Sheet
//  */
// function deleteFileByUrl(fileUrl) {
//   if (!fileUrl || fileUrl === "-" || !fileUrl.includes("/d/")) return;
  
//   try {
//     // ‡πÅ‡∏Å‡∏∞ ID ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å URL (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö https://lh5.googleusercontent.com/d/FILE_ID)
//     const fileId = fileUrl.split('/d/')[1];
//     if (fileId) {
//       DriveApp.getFileById(fileId).setTrashed(true); // ‡∏¢‡πâ‡∏≤‡∏¢‡∏•‡∏á‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞
//       Logger.log("‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: " + fileId);
//     }
//   } catch (e) {
//     // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß) ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
//     Logger.log("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ: " + e.message);
//   }
// }

// /**
//  * ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö Card ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Chat Webhook.
//  * ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CHAT_WEBHOOK_URL ‡πÉ‡∏ô Script Properties.
//  * @param {Object} formData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°.
//  * @param {string} fullAddress - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°.
//  * @param {Date} now - ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏ Date ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô.
//  */
// function sendNotificationToChat(formData, fullAddress, now) {
//   let CHAT_WEBHOOK_URL;
//   try {
//     CHAT_WEBHOOK_URL = getChatWebhookUrl(); // Get URL from Script Properties
//   } catch (e) {
//     Logger.log("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Chat ‡πÑ‡∏î‡πâ: " + e.message);
//     console.error("Error getting Webhook URL from properties:", e);
//     return; // Stop execution if URL is not available
//   }

//   const formattedDateTime = Utilities.formatDate(now, Session.getScriptTimeZone(), "dd/MM/yyyy, HH:mm ‡∏ô.");

//   // --- ‡πÅ‡∏°‡∏õ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö HTML ---
//   const prefix = String(formData.title_Name || '').trim();
//   const firstName = String(formData.firstName || '').trim();
//   const lastName = String(formData.lastName || '').trim();
//   const fullName = `${prefix}${firstName} ${lastName}`.trim();

//   const email = String(formData.email || '').trim();
//   const tel = String(formData.phoneNumber || '').trim();
//   const license = String(formData.proLicense || '').trim();
//   const foodType = String(formData.foodType || '').trim();
//   const receiptName = String(formData.name_Receipt || '').replace(/[\r\n]+/g, ' ').trim();
//   const taxId = String(formData.taxpayer_ID || '').trim() || '-';
//   const statusRegister = String(formData.status_Register || '-').trim();

//   // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
//   let workPlaceDisplay = "";
//   let positionDisplay = "";

//   if (formData.status_Register === REG_STATUS.INTERNAL) {
//     workPlaceDisplay = (formData.workGroup || '-') + " / " + (formData.department || '-');
//     positionDisplay = formData.internalPosition || '-';
//   } else if (formData.status_Register === REG_STATUS.QUOTA) {
//     workPlaceDisplay = formData.affiliation || '-';
//     if (formData.affiliation_otherText) workPlaceDisplay += " (" + formData.affiliation_otherText + ")";
//     positionDisplay = "‡∏ú‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤";
//   } else {
//     workPlaceDisplay = String(formData.workPlace || '-').replace(/[\r\n]+/g, ' ').trim();
//     positionDisplay = formData.externalPosition || '-';
//     if (positionDisplay === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") positionDisplay = formData.externalPosition_OtherText || '-';
//   }
//   // -------------------------------------------

//   const cardMessage = {
//     cards: [
//       {
//         header: {
//           title: "üîî ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà!",
//           subtitle: `# ${formData.status_Register || '‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• 2569'} #`,
//         },
//         sections: [
//           {
//             header: "‚úÖ <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</b>",
//             widgets: [
//               { textParagraph: { text: `üóìÔ∏è <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</b> ${formattedDateTime}` } },
//               { textParagraph: { text: `üë§ <b>‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</b> ${fullName}` } },
//               { keyValue: { 
//                   topLabel: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô", 
//                   content: `<b>${statusRegister}</b>`,
//                   contentMultiline: true 
//               } },              
//               { keyValue: { content: "üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: " + (email || '-') } },
//               { keyValue: { content: "üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: " + (tel || '-') } },
//               { keyValue: { content: "üìÑ ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û: " + (license || '-') } },
//               { keyValue: { content: "üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: " + (workPlaceDisplay || '-') } },
//               { keyValue: { content: "üè∑Ô∏è ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: " + (positionDisplay || '-') } },
//               { keyValue: { content: "üçΩÔ∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≤‡∏´‡∏≤‡∏£: " + (foodType || '-') } },
//             ]
//           },
//           {
//             header: "‚úÖ <b>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</b>",
//             widgets: [
//               { keyValue: { content: "üë§ ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à: " + (receiptName || '-') } },
//               { keyValue: { content: "üè† ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: " + (fullAddress || '-'), contentMultiline: true } },
//               { keyValue: { content: "üßæ ‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ: " + (taxId || '-') } },
//             ]
//           },
//           {
//             header: "‚úÖ <b>Link</b>",
//             widgets: [
//               {
//                 buttons: [
//                   {
//                     textButton: {
//                       text: "üìÇ ‡πÄ‡∏õ‡∏¥‡∏î Google Sheet",
//                       onClick: {
//                         openLink: {
//                           url: "https://docs.google.com/spreadsheets/d/1PW2fz87N-k0HpUWAKYQn_T1tyTIp69BxdOTkyXABoA0/edit?gid=817244781#gid=817244781",
//                         }
//                       }
//                     }
//                   }
//                 ]
//               }
//             ]
//           }
//         ]
//       }
//     ]
//   };

//   const options = {
//     method: 'POST',
//     contentType: 'application/json',
//     payload: JSON.stringify(cardMessage),
//     muteHttpExceptions: true 
//   };

//   Logger.log("Attempting to send Google Chat notification...");

//   try {
//     const response = UrlFetchApp.fetch(CHAT_WEBHOOK_URL, options);
//     const responseCode = response.getResponseCode();
//     if (responseCode >= 200 && responseCode < 300) {
//       Logger.log("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Chat ‡πÅ‡∏•‡πâ‡∏ß");
//     } else {
//       Logger.log(`‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î HTTP Status: ${responseCode}`);
//     }
//   } catch (error) {
//     Logger.log("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Chat: " + error.message);
//   }
// }

// /** ‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô */
// function getWorkGroupData() {
//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG);
//   if (!sheet || sheet.getLastRow() < 2) return {}; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Error ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
//   const data = sheet.getRange("A2:B" + sheet.getLastRow()).getValues();
//   const result = {};
//   Logger.log("data: "+ JSON.stringify(data));

//   data.forEach(([group, dept]) => {
//     if (group && dept) {
//       if (!result[group]) result[group] = [];
//       if (!result[group].includes(dept)) {
//         result[group].push(dept);
//       }
//     }
//   });

//   return result;
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡∏°‡πà
//  */
// function saveNewQA(group, dept) {
//   if (!group || !dept || group === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" || dept === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") return;

//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG);
//   if (!sheet) return;

//   const data = sheet.getDataRange().getValues();
  
//   // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏π‡πà ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô-‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
//   const isDuplicate = data.some(row => 
//     row[0].toString().trim().toLowerCase() === group.trim().toLowerCase() &&
//     row[1].toString().trim().toLowerCase() === dept.trim().toLowerCase()
//   );

//   if (!isDuplicate) {
//     sheet.appendRow([group.trim(), dept.trim()]);
//     // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A)
//     const lastRow = sheet.getLastRow();
//     if (lastRow > 1) {
//       sheet.getRange(2, 1, lastRow - 1, 2).sort([{column: 1, ascending: true}, {column: 2, ascending: true}]);
//     }
//   }
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î
// function getAffiliationData() {
//   try {
//     const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG);
//     if (!sheet) return [];
    
//     const lastRow = sheet.getLastRow();
//     if (lastRow < 2) return []; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢
//     const data = sheet.getRange("C2:C" + lastRow).getValues();
    
//     // ‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å Array 2 ‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô Array 1 ‡∏°‡∏¥‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
//     return data.flat().filter(item => item.toString().trim() !== "");
//   } catch (e) {
//     console.log("Error: " + e.message);
//     return [];
//   }
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á Sheet ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
//  */
// function saveNewAffiliationIfMissing(newAffiliation) {
//   if (!newAffiliation || newAffiliation === "" || newAffiliation === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") return;

//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG);
//   if (!sheet) return;

//   const lastRow = sheet.getLastRow();
//   let existingData = [];
  
//   if (lastRow >= 2) {
//     existingData = sheet.getRange("C2:C" + lastRow).getValues().flat();
//   }

//   // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á (Case-insensitive ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á)
//   const isDuplicate = existingData.some(item => 
//     item.toString().trim().toLowerCase() === newAffiliation.trim().toLowerCase()
//   );

//   if (!isDuplicate) {
//     sheet.appendRow([newAffiliation.trim()]);
//     // (Option) ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á Sort ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°
//     const newLastRow = sheet.getLastRow();
//     if (newLastRow > 2) {
//       sheet.getRange("C2:C" + newLastRow).sort({column: 3, ascending: true});
//     }
//   }
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û
// function getProfessionData() {
//   try {
//     const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG); 
//     if (!sheet) return [];
//     const lastRow = sheet.getLastRow();
//     if (lastRow < 2) return [];
//     const data = sheet.getRange("D2:D" + lastRow).getValues();
//     return data.flat().filter(item => item.toString().trim() !== "");
//   } catch (e) {
//     return [];
//   }
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡πÉ‡∏´‡∏°‡πà
// function saveNewProfession(profession) {
//   if (!profession || profession === "" || profession === "‡∏≠‡∏∑‡πà‡∏ô‡πÜ") return;

//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG);
//   if (!sheet) return;

//   const lastRow = sheet.getLastRow();
//   let existingData = [];
//   if (lastRow >= 2) {
//     existingData = sheet.getRange("D2:D" + lastRow).getValues().flat();
//   }

//   const isDuplicate = existingData.some(item => 
//     item.toString().trim().toLowerCase() === profession.trim().toLowerCase()
//   );

//   if (!isDuplicate) {
//     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ñ‡∏ß‡πÉ‡∏´‡∏°‡πà
//     sheet.getRange(lastRow + 1, 4).setValue(profession.trim());
//     sheet.getRange("D2:D" + (lastRow + 1)).sort({column: 4, ascending: true});
//   }
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
// function getPrefixData() {
//   try {
//     const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_CONFIG); 
//     if (!sheet) return [];
//     const lastRow = sheet.getLastRow();
//     if (lastRow < 2) return [];
//     const data = sheet.getRange("E2:E" + lastRow).getValues();
//     return data.flat().filter(item => item.toString().trim() !== "");
//   } catch (e) {
//     return [];
//   }
// }

// /**
//  * ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ ID ‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A)
//  */
// function searchUser(query) {
//   try {
//     const searchTerm = String(query || "").toLowerCase().trim();
//     if (searchTerm === "" || searchTerm === "-") return { success: false, message: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" };

//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName(SHEET_DATA);
//     const data = sheet.getDataRange().getValues();
//     const headers = data[0];
//     const rows = data.slice(1);

//     const idxId = getIdx(headers, COL.ID);
//     const idxEmail = getIdx(headers, COL.EMAIL);
//     const idxLicense = getIdx(headers, COL.LICENSE);
//     const idxAttend1 = getIdx(headers, COL.ATTEND_1);
//     const idxAttend2 = getIdx(headers, COL.ATTEND_2);
//     const idxCert = getIdx(headers, COL.CERT_URL);

//     const filteredRows = [];
//     rows.forEach((row, i) => {
//       const idVal = String(row[idxId] || "").toLowerCase().trim();
//       const emailVal = String(row[idxEmail] || "").toLowerCase().trim();
//       const licenseVal = String(row[idxLicense] || "").trim();

//       if (idVal === searchTerm || emailVal === searchTerm || licenseVal === searchTerm) {
//         const userData = { rowNumber: i + 2 };
//         headers.forEach((h, index) => {
//           let val = row[index];
//           if (val instanceof Date) val = Utilities.formatDate(val, Session.getScriptTimeZone(), "dd/MM/yyyy HH:mm");
//           userData[h] = val;
//         });

//         userData['canDownload'] = (row[idxAttend1] === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°" && row[idxAttend2] === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°");
//         userData['certUrl'] = row[idxCert] || "#";
//         filteredRows.push(userData);
//       }
//     });

//     return filteredRows.length > 0 ? { success: true, data: filteredRows } : { success: false, message: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" };
//   } catch (e) {
//     return { success: false, message: e.toString() };
//   }
// }

// // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å (‡∏ù‡∏±‡πà‡∏á Server)
// function trackDownload(rowNumber) {
//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_DATA);
//   const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
//   const idxDown = getIdx(headers, COL.DOWNLOAD);
  
//   const lock = LockService.getScriptLock();
//   try {
//     lock.waitLock(10000);
//     const cell = sheet.getRange(rowNumber, idxDown + 1);
//     const count = (Number(cell.getValue()) || 0) + 1;
//     cell.setValue(count);
//     return { success: true, newCount: count };
//   } finally {
//     lock.releaseLock();
//   }
// }

// //======== ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà =================
// const SHEET_USER = "user"; 

// /**
//  * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Login ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (admin/editor)
//  */
// /**
//  * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Login ‡∏î‡πâ‡∏ß‡∏¢ Password ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
//  * ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A: Password, B: ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô, C: ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
//  */
// function checkAdminLogin(password) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName("user");
//   if (!sheet) return { success: false, message: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Sheet: user)" };

//   const data = sheet.getDataRange().getValues();
//   const inputPass = String(password || "").trim();

//   for (let i = 1; i < data.length; i++) {
//     const sheetPass = String(data[i][0]).trim();
//     const sheetUser = String(data[i][1]).trim(); // ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
//     const sheetRole = String(data[i][2]).trim().toLowerCase();

//     if (sheetPass === inputPass) {
//       return { 
//         success: true, 
//         username: sheetUser, // ‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á
//         role: sheetRole 
//       };
//     }
//   }
//   return { success: false, message: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" };
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Admin
//  */
// function getAdminAllData() {
//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_DATA);
//   const data = sheet.getDataRange().getValues();
//   if (data.length < 1) return [];
  
//   const headers = data[0];
//   const rows = data.slice(1);
  
//   return rows.map((row, index) => {
//     let obj = { rowNumber: index + 2 };
//     headers.forEach((h, idx) => {
//       let val = row[idx];
//       if (val instanceof Date) val = Utilities.formatDate(val, Session.getScriptTimeZone(), "dd/MM/yyyy HH:mm");
//       obj[h] = val;
//     });
//     return obj;
//   });
// }

// /** ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Admin */
// function updateAdminStatus(rowNumber, statusData) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName(SHEET_DATA);
//   const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
  
//   try {
//     // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Sheet ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
//     const currentRow = sheet.getRange(rowNumber, 1, 1, headers.length).getValues()[0];
    
//     const setVal = (colName, newValue) => {
//       const idx = getIdx(headers, colName);
//       const oldValue = currentRow[idx];
      
//       let finalValue = newValue;

//       // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏ß‡∏•‡∏≤ (ATTEND_1_TIME / ATTEND_2_TIME)
//       if (colName === COL.ATTEND_1_TIME || colName === COL.ATTEND_2_TIME) {
//         // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß -> ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢)
//         if (!newValue && oldValue) {
//           finalValue = oldValue;
//         }
//       }
      
//       // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Sheet ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏£‡∏∞‡∏ö‡∏ö)
//       if (finalValue !== oldValue) {
//         sheet.getRange(rowNumber, idx + 1).setValue(finalValue);
//       }
//     };

//     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö Array ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
//     setVal(COL.PAYIN_STATUS,   statusData[0]);
//     setVal(COL.PAYMENT_STATUS, statusData[1]);
//     setVal(COL.ATTEND_1,       statusData[2]);
//     setVal(COL.ATTEND_2,       statusData[3]);
//     setVal(COL.ATTEND_1_TIME,  statusData[4]);
//     setVal(COL.ATTEND_2_TIME,  statusData[5]);
//     setVal(COL.CERT_URL,       statusData[6]);
//     setVal(COL.DOWNLOAD,       statusData[7]);

//     return { success: true };
//   } catch (e) {
//     return { success: false, message: e.toString() };
//   }
// }

// /**
//  * ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
//  */
// function deleteRegistration(rowNumber) {
//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_DATA);
//   try {
//     sheet.deleteRow(rowNumber);
//     return { success: true };
//   } catch (e) {
//     return { success: false, message: e.toString() };
//   }
// }

// /**
//  * ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•
//  */
// /**
//  * ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
//  */
// function saveAssessment(formData) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   let sheet = ss.getSheetByName("Assessment");
  
//   // 1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Headers) 
//   // üî¥ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô" ‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏´‡∏±‡∏™‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å"
//   const headers = [
//     "Timestamp", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô", "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°", "‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å", "‡∏£‡∏´‡∏±‡∏™‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å",
//     "1.1", "1.2", "1.3", "1.4", "1.5",
//     "2.1", "2.2", "2.3", "2.4", "2.5",
//     "3.1", "3.2", "3.3", "3.4", "3.5",
//     "4.1", "4.2", "4.3", "4.4", "4.5",
//     "5.1", "5.2", "5.3", "5.4", "5.5", 
//     "6.1", "6.2", "6.3", "6.4", "6.5",
//     "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤", "‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞"
//   ];

//   if (!sheet) {
//     sheet = ss.insertSheet("Assessment");
//     sheet.getRange(1, 1, 1, headers.length).setValues([headers])
//          .setBackground("#004085").setFontColor("white").setFontWeight("bold");
//     sheet.setFrozenRows(1);
//   }

//   // üü¢ 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Auto Number: G-001)
//   let luckyNumber = "-"; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á
  
//   if (formData.gift === "‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å") {
//     // ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö Lock ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ô‡∏Å‡∏î‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô (Race condition)
//     const lock = LockService.getScriptLock();
//     lock.waitLock(10000); // ‡∏£‡∏≠‡∏Ñ‡∏¥‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    
//     try {
//       const props = PropertiesService.getScriptProperties();
      
//       // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0
//       let currentNumber = parseInt(props.getProperty('LuckyDrawCounter') || '0');
      
//       // ‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏° 1
//       currentNumber += 1;
      
//       // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
//       props.setProperty('LuckyDrawCounter', currentNumber.toString());
      
//       // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô G-001, G-015, G-999
//       luckyNumber = "G-" + ("000" + currentNumber).slice(-3);
      
//     } finally {
//       lock.releaseLock(); // ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
//     }
//   }

//   const timestamp = Utilities.formatDate(new Date(), Session.getScriptTimeZone(), "dd/MM/yyyy HH:mm:ss");

//   // 3. ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
//   let rowData = [
//     timestamp,
//     formData.evalDay === 1 ? "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 (25 ‡∏™.‡∏Ñ.)" : "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2 (26 ‡∏™.‡∏Ñ.)",
//     formData.origin || "-",
//     formData.gift || "-",
//     luckyNumber // üü¢ ‡∏ô‡∏≥‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÅ‡∏ó‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠
//   ];

//   // 4. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô q1_1 ‡∏ñ‡∏∂‡∏á q6_5 ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß
//   const maxMain = 6; 
//   for (let m = 1; m <= maxMain; m++) {
//     for (let s = 1; s <= 5; s++) {
//       let key = "q" + m + "_" + s;
//       rowData.push(formData[key] || ""); 
//     }
//   }

//   // 5. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡πâ‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡∏°
//   rowData.push(formData.overallRating || "");
//   rowData.push(formData.nextTopic || "");
//   rowData.push(formData.feedback || "");

//   try {
//     sheet.appendRow(rowData);
    
//     // üü¢ 6. ‡∏™‡πà‡∏á luckyNumber ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏î‡πâ‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
//     return { 
//       success: true, 
//       message: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö",
//       luckyNumber: luckyNumber !== "-" ? luckyNumber : null 
//     };
    
//   } catch (e) {
//     return { success: false, message: "Error: " + e.toString() };
//   }
// }

// // üõ†Ô∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°: ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0 ‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏ä‡πâ‡∏£‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ Script Editor)
// function resetLuckyDrawCounter() {
//   PropertiesService.getScriptProperties().setProperty('LuckyDrawCounter', '0');
//   Logger.log("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô G-001 ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
//  */
// /**
//  * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå AL, AM
//  */
// function getAssessmentSummary(filter) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName("Assessment");
//   if (!sheet) return { success: false, message: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" };

//   const data = sheet.getDataRange().getValues();
//   const headers = data[0];
//   const rows = data.slice(1);

//   let summary = {};
//   let textComments = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö AL ‡πÅ‡∏•‡∏∞ AM
//   let totalFiltered = 0;

//   // ‡∏ó‡∏≥ Map ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
//   const headerMap = {};
//   headers.forEach((h, idx) => { headerMap[h] = idx; });

//   // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô q1_1 ‡∏ñ‡∏∂‡∏á q6_5
//   for (let m = 1; m <= 6; m++) {
//     for (let s = 1; s <= 5; s++) {
//       summary[`q${m}_${s}`] = { "‡∏°‡∏≤‡∏Å": 0, "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á": 0, "‡∏ô‡πâ‡∏≠‡∏¢": 0 };
//     }
//   }

//   rows.forEach(row => {
//     const rowDate = String(row[1] || "");    
//     const rowOrigin = String(row[2] || "");  

//     const matchDate = !filter.date || rowDate.includes(filter.date);
//     const matchOrigin = !filter.origin || rowOrigin === filter.origin;

//     if (matchDate && matchOrigin) {
//       totalFiltered++;
      
//       // 1. ‡∏ô‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô (‡πÄ‡∏î‡∏¥‡∏°)
//       for (let m = 1; m <= 6; m++) {
//         for (let s = 1; s <= 5; s++) {
//           let colHeader = `${m}.${s}`;
//           let colIdx = headerMap[colHeader];
//           if (colIdx !== undefined) {
//             let val = String(row[colIdx] || "").trim(); 
//             if (summary[`q${m}_${s}`][val] !== undefined) {
//               summary[`q${m}_${s}`][val]++;
//             }
//           }
//         }
//       }

//       // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå AL ‡πÅ‡∏•‡∏∞ AM (‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞)
//       // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏‡∏°‡∏≤
//       const nextTopic = String(row[headerMap["‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤"]] || "").trim();
//       const suggestion = String(row[headerMap["‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞"]] || "").trim();
      
//       // ‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏°‡∏≤
//       if ((nextTopic && nextTopic !== "-") || (suggestion && suggestion !== "-")) {
//         textComments.push({
//           topic: nextTopic || "-",
//           feedback: suggestion || "-"
//         });
//       }
//     }
//   });

//   return {
//     success: true,
//     totalResponses: totalFiltered,
//     results: summary,
//     comments: textComments // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡∏ó‡∏≥‡∏ï‡∏≤‡∏£‡∏≤‡∏á
//   };
// }

// // Scan QR Code ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°"
// function recordAttendance(decodedText, day) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName(SHEET_DATA);
//   const data = sheet.getDataRange().getValues();
//   const headers = data[0];

//   const idxId = getIdx(headers, COL.ID);
//   const idxFname = getIdx(headers, COL.FNAME);
//   const idxLname = getIdx(headers, COL.LNAME);
  
//   const colAttendName = (day == 1) ? COL.ATTEND_1 : COL.ATTEND_2;
//   const colTimeName = (day == 1) ? COL.ATTEND_1_TIME : COL.ATTEND_2_TIME;
  
//   const idxAttend = getIdx(headers, colAttendName);
//   const idxTime = getIdx(headers, colTimeName);

//   const parts = decodedText.split('|');
//   if (parts.length < 3) return { success: false, message: "‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö QR Code ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á" };

//   const sId = parts[0].trim();
//   const sFname = parts[1].trim();
//   const sLname = parts[2].trim();

//   for (let i = 1; i < data.length; i++) {
//     // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô
//     if (String(data[i][idxId]) === sId && 
//         String(data[i][idxFname]).trim() === sFname && 
//         String(data[i][idxLname]).trim() === sLname) {
      
//       // 2. [‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç] ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
//       const userObj = {};
//       userObj['rowNumber'] = i + 1;
//       headers.forEach((h, idx) => {
//         let val = data[i][idx];
//         if (val instanceof Date) {
//           val = Utilities.formatDate(val, Session.getScriptTimeZone(), "dd/MM/yyyy HH:mm:ss");
//         }
//         userObj[h] = val;
//       });

//       // 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥
//       if (data[i][idxAttend] === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°") {
//         return { 
//           success: false, 
//           isDuplicate: true,
//           message: "‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß",
//           userData: userObj // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Frontend ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏¥‡∏°
//         };
//       }

//       // 4. ‡∏Å‡∏£‡∏ì‡∏µ‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
//       const now = Utilities.formatDate(new Date(), Session.getScriptTimeZone(), "dd/MM/yyyy HH:mm:ss");
      
//       sheet.getRange(i + 1, idxAttend + 1).setValue("‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°"); 
//       sheet.getRange(i + 1, idxTime + 1).setValue(now);           
      
//       // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô object ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö
//       userObj[colTimeName] = now;

//       return { 
//         success: true, 
//         message: "‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", 
//         userData: userObj 
//       };
//     }
//   }
//   return { success: false, message: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö" };
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏•‡∏≥‡∏î‡∏±‡∏ö Index ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà 0)
// function getIdx(headers, name) {
//   const index = headers.indexOf(name);
//   if (index === -1) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ä‡∏∑‡πà‡∏≠: " + name);
//   return index;
// }

// // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£)
// function incrementDownloadCount(fileIdentifier) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   let sheet = ss.getSheetByName("DownloadCount");
//   if (!sheet) {
//     sheet = ss.insertSheet("DownloadCount");
//     sheet.getRange("A1").setValue(0);
//   }
//   const cell = sheet.getRange("A1");
//   let val = parseInt(cell.getValue() || 0);
//   let newVal = val + 1;
//   cell.setValue(newVal);
//   return newVal; // üü¢ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ Vue.js ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó Badge
// }

// // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
// function getCurrentDownloadCount(fileIdentifier) {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName("DownloadCount");
//   if (!sheet) return 0;
//   return sheet.getRange("A1").getValue() || 0; // üü¢ ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≤‡∏Å Sheet "Timer" ‡∏ä‡πà‡∏≠‡∏á A2
//  */
// function getDeadlineFromSheet() {
//   try {
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName('Timer');
    
//     if (!sheet) {
//       console.error("‡∏´‡∏≤ Sheet 'Timer' ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠");
//       return null;
//     }

//     // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á A2 (‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà 1)
//     const rawValue = sheet.getRange(2, 1).getValue(); 
    
//     // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Date Object
//     const deadlineValue = new Date(rawValue);
    
//     // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
//     if (isNaN(deadlineValue.getTime())) {
//       console.error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á A2 ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
//       return null;
//     }

//     // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Log ‡∏î‡∏π‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
//     console.log("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å A2 ‡∏Ñ‡∏∑‡∏≠: " + deadlineValue.toLocaleString('th-TH'));

//     // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Timestamp (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
//     return deadlineValue.getTime();

//   } catch (e) {
//     console.error("Error reading Timer sheet A2: " + e.message);
//     return null;
//   }
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡∏à‡∏≤‡∏Å Sheet Timer ‡∏ä‡πà‡∏≠‡∏á B2
//  */
// function getExternalDeadline() {
//   try {
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName('Timer');
//     if (!sheet) return null;

//     const rawValue = sheet.getRange("B2").getValue();
//     const dateObj = new Date(rawValue);
    
//     // ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Timestamp (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ JavaScript ‡∏ù‡∏±‡πà‡∏á Client ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢
//     return isNaN(dateObj.getTime()) ? null : dateObj.getTime();
//   } catch (e) {
//     return null;
//   }
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô
//  * ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C (3): ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1
//  * ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D (4): ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2
//  */
// function getAssessmentTimer() {
//   try {
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName('Timer');
//     if (!sheet) return null;

//     const getTimestampFromCell = (row, col) => {
//       const rawValue = sheet.getRange(row, col).getValue(); 
//       const dateObj = new Date(rawValue);
//       return isNaN(dateObj.getTime()) ? null : dateObj.getTime();
//     };

//     // ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ï‡πá‡∏°
//     return {
//       day1Open:  getTimestampFromCell(2, 3), // C2
//       day1Close: getTimestampFromCell(3, 3), // C3
//       day2Open:  getTimestampFromCell(2, 4), // D2
//       day2Close: getTimestampFromCell(3, 4)  // D3
//     };
//   } catch (e) {
//     return null;
//   }
// }

// /**
//  * ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å Sheet "Timer" ‡∏ä‡πà‡∏≠‡∏á F2
//  */
// function getCertDownloadDeadline() {
//   try {
//     const ss = SpreadsheetApp.getActiveSpreadsheet();
//     const sheet = ss.getSheetByName('Timer');
//     if (!sheet) return null;

//     // F2 ‡∏Ñ‡∏∑‡∏≠ ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà 6
//     const rawValue = sheet.getRange(2, 6).getValue(); 
//     const deadlineDate = new Date(rawValue);
    
//     if (isNaN(deadlineDate.getTime())) {
//       console.error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á F2 ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
//       return null;
//     }

//     // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Timestamp (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
//     return deadlineDate.getTime();
//   } catch (e) {
//     console.error("Error reading Timer sheet F2: " + e.message);
//     return null;
//   }
// }

// /**
//  * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö
//  */
// function clearTimerCache() {
//   const cache = CacheService.getScriptCache();
//   cache.remove("deadline_timestamp");
//   console.log("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ä‡∏£‡∏∞‡∏ö‡∏ö Timer ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
// }

// /** ‡∏™‡πà‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏• ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà html  */
// function getAssessmentConfig() {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName("AssessmentConfig");
//   const data = sheet.getDataRange().getValues();
//   data.shift(); // ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
  
//   const day1 = [];
//   const day2 = [];

//   data.forEach(row => {
//     const day = row[0];
//     const id = row[1];
//     const title = row[2];
    
//     // 1. ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£
//     const names = String(row[3]).split(',').map(s => s.trim());
//     const depts = String(row[4]).split(',').map(s => s.trim());
    
//     // 2. ‡πÅ‡∏¢‡∏Å URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
//     const imgsRaw = String(row[5]).split(',').map(s => s.trim());
//     const imgs = imgsRaw.map(url => driveToDirectLink(url)); // << ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    
//     const speakers = names.map((name, index) => ({
//       name: name,
//       dept: depts[index] || depts[0], // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏™‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡πÅ‡∏£‡∏Å
//       img: imgs[index] || "" // ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß (lh5)
//     }));

//     const questionObj = { id, title, speakers };

//     if (day == 1) day1.push(questionObj);
//     if (day == 2) day2.push(questionObj);
//   });

//   return { success: true, day1, day2 };
// }

// /** ‡∏™‡πà‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà html  */
// function getScheduleFromSheet() {
//   const ss = SpreadsheetApp.getActiveSpreadsheet();
//   const sheet = ss.getSheetByName("ScheduleData");
//   const data = sheet.getDataRange().getValues();
//   data.shift(); // ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
  
//   const now = new Date();
//   const schedule = { day1: [], day2: [] };

//   data.forEach((row, index) => {
//     const rowNum = index + 2; // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏•‡∏Ç‡πÅ‡∏ñ‡∏ß‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
//     const openDate = row[9] ? new Date(row[9]) : null;
    
//     const session = {
//       rowNumber: rowNum,
//       day: row[0],
//       time: row[1],
//       title: row[2],
//       isBreak: row[3] === true || row[3] === "TRUE",
//       icon: row[4],
//       speaker: { 
//         name: row[5], 
//         dept: row[6], 
//         // --- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ---
//         img: driveToDirectLink(row[7]) 
//       },
//       file: {
//         url: row[8] || "",
//         count: row[10] || 0, // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå K
//         isOpen: openDate ? now >= openDate : true,
//         openDateStr: openDate ? openDate.toLocaleString('th-TH') : ""
//       }
//     };

//     if (session.day == 1) schedule.day1.push(session);
//     if (session.day == 2) schedule.day2.push(session);
//   });

//   return { success: true, data: schedule, sheetUrl: ss.getUrl() };
// }

// // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£
// function trackFileDownload(rowNum) {
//   const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("ScheduleData");
//   const cell = sheet.getRange(rowNum, 11); // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå K
//   const currentCount = parseInt(cell.getValue()) || 0;
//   cell.setValue(currentCount + 1);
//   return currentCount + 1;
// }


// /**
//  * ‡πÅ‡∏õ‡∏•‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive ‡πÄ‡∏õ‡πá‡∏ô Direct Link (lh5)
//  */
// function driveToDirectLink(url) {
//   if (!url || typeof url !== 'string' || url === '-' || url === '') return "";
  
//   // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ File ID ‡∏à‡∏≤‡∏Å URL
//   const match = url.match(/\/d\/(.+?)\/(view|edit|usp|$|#|\?)/);
//   if (match && match[1]) {
//     return `https://lh5.googleusercontent.com/d/${match[1]}`;
//   }
//   return url; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå Drive ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
// }
